## 4. 파일과 디렉터리


### 1. stat, fstat, tstatat, lstat

- stat 
pathname 인수로 지정된 파일에 대한 정보를 한 구조체에 담아 돌려준다.

- fstat
fd인수로 지정된 파일 서술자에 대해 이미 열려 있는 파일에 관한 정보를 돌려준다.

- lstat
stat과 비슷하되 기호 링크에 대한 정보를 돌려준다.

- fstatat
fd 인수로 지정된 파일 서술자에 해당하는 열린 디렉터리를 기준으로 한 상대 경로이름에 관한 파일 통계치를 돌려준다.
flag의 값에 따라 stat 아니면 lstat처럼 행동한다.


#### stat 구조체 멤버들이 대부분 기본 시스템 자료형식임

---

### 파일 종류 
1. 정규파일(regular file) 가장 흔한종류의 파일
  - 어떤 형태이든 자료를 담음
  - 해석은 파일 처리하는 응용프로그램 몫

2. 디렉터리 파일
  - 다른 파일들의 이름과 그 파일들에 대한 정보로의 포인터들을 담은 파일
  - 디렉터리 파일에 직접 쓸 수 있는 것은 커널뿐

3. 블록 특수 파일
  - 디스크 드라이브 같은 장치에 대해 고정 크기 단위의 버퍼링 있는 입출력 접근을 제공하는 파일
4. 문자 특수 파일
  - 장치에 대한 가변 크기 단위의 버퍼링 없는 입출력 접근을 제공하는 파일
5. FIFO 
  - 프로세스들 사이의 통신에 쓰이는 파일
6. socket
  - 프로세스들 사이의 네트워크 통신에 쓰이는 파일
7. 기호링크 (symbolic link)
  - 다른 파일을 기리키는 파일

### 사용자-ID-설정 비트와 그룹-ID-설정 비트
모든 프로세스에는 각각 여섯 개 이상의 ID들이 연관된다.

- 실제 사용자 ID , 실제 그룹 ID
  - 사용자나 그룹이 실제로 누구인지 알려주는 ID들
- 유효 사용자 ID, 유효그룹 ID, 추가그룹 ID들
  - 파일 접근 권한 점검에 쓰임
- 저장된 사용자 ID, 저장된 그룹 ID
  - exec류 함수들이 저장함

### 파일 접근 권한
- st_mode 값에는 파일에 대한 접근 권한 비트들도 부호화되어 있다.

- 커널이 판정을 수행하는 방식
  - 프로세스 유효사용자 ID = 0(슈퍼사용자)이면 접근이 허용된다.
  - 유효사용자 ID가 파일 소유자 ID와 같은 경우, 적절한 접근 권한비트가 설정되어 있어야 접근이 허용됨
  - 유효그룹 ID나 프로세스의 추가그룹ID들 중 하나가 파일의 그룹아이디와 같은 경우, 적절한그룹접근권한비트가 설정되어있으면 접근허용
  - 적절한 기타접근허용비트가 설정되어있으면 접근허용

이건 순서대로 적용됨


### 새 파일과 디렉터리 소유권
1. 새 파일의 사용자 아이디는 프로세스의 유효사용자 아이디로 설정 됨
2. 디렉터리의 그룹아이디를 불려받는 방식에서는 항상 한 디렉터리 안에 생성된 모든 파일과 디렉터리가 동일한 그룹아이디를 가지게 된다. 